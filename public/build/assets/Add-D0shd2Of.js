import{r as m,a as z,j as e,M as F}from"./app-CHwCV11J.js";import{A as G}from"./AuthenticatedLayout-DJeuts4J.js";import{D as H,k as L}from"./index-Cbo0WBc8.js";import{b as R}from"./index-CHtA-PwU.js";import U from"./ExtraArticlesSection-CZ1oGl7-.js";import B from"./PanierSelectionSection-a4vsdl73.js";import J from"./Cart-D3N--LIb.js";import{m as b}from"./proxy-DJ9UI43g.js";import"./pdfmake-BosuxZz1.js";import"./transition-q1sA79Xm.js";import"./iconBase-gZrb97Dr.js";import"./index-CL0q78PR.js";const rt=({paniers:x,articles:p})=>{const[c,v]=m.useState([]),[l,g]=m.useState({}),[d,w]=m.useState([]),[u,h]=m.useState({}),[A,f]=m.useState(!1),{data:y,setData:o,post:D,errors:j,processing:C}=z({date:"",description:"",paniers:[],articles_commandes:[]}),E=t=>{v(s=>{let r;if(s.includes(t)){r=s.filter(n=>n!==t);const a={...l};delete a[t],g(a)}else r=[...s,t],g(a=>({...a,[t]:1}));const i=r.map(a=>({panier_id:a,quantity:l[a]||1}));return o("paniers",i),r})},Q=t=>{w(s=>{let r;if(s.includes(t)){r=s.filter(n=>n!==t);const a={...u};delete a[t],h(a)}else r=[...s,t],h(a=>({...a,[t]:1}));const i=r.map(a=>({article_id:a,quantity:u[a]||1}));return o("articles_commandes",i),r})},_=t=>{t.preventDefault();const s=c.map(i=>({panier_id:i,quantity:l[i]||1})),r=d.map(i=>({article_id:i,quantity:u[i]||1}));o("paniers",s),o("articles_commandes",r),D(route("commandes.store"),{onSuccess:()=>{},onError:()=>{L.error("Une erreur s'est produite lors de la création de la commande.")}})},q=(t,s)=>{g(r=>{const i={...r,[t]:s},a=c.map(n=>({panier_id:n,quantity:i[n]||1}));return o("paniers",a),i})},P=(t,s)=>{h(r=>{const i={...r,[t]:s},a=d.map(n=>({article_id:n,quantity:i[n]||1}));return o("articles_commandes",a),i})},k=t=>{const s=l[t.id]||1;return t.price*s},N=t=>{const s=u[t.id]||1;return t.price*s},T=()=>{const t=c.reduce((r,i)=>{const a=x.find(n=>n.id===i);return r+k(a)},0),s=d.reduce((r,i)=>{const a=p.find(n=>n.id===i);return r+N(a)},0);return t+s},S=c.length+d.length,O=()=>{f(!0)},M=()=>{f(!1)};return e.jsxs(G,{header:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800 dark:text-gray-200",children:"Ajouter une commande"}),children:[e.jsx(F,{title:"Ajouter une commande"}),e.jsx(H,{position:"bottom-center",reverseOrder:!1}),e.jsx("div",{className:"fixed bottom-4 right-4 z-50",children:e.jsxs("button",{onClick:O,className:"relative p-3 bg-indigo-600 rounded-full text-white hover:bg-indigo-500 focus:outline-none",children:[e.jsx(R,{className:"w-6 h-6"}),S>0&&e.jsx("span",{className:"absolute top-0 right-0 bg-red-500 text-white text-xs rounded-full px-2 py-1",children:S})]})}),e.jsx(J,{paniers:x,articles:p,selectedPaniers:c,panierQuantities:l,selectedExtraArticles:d,extraArticleQuantities:u,isCartOpen:A,setIsCartOpen:f,closeCart:M,calculateGrandTotal:T,calculatePanierTotal:k,calculateExtraArticleTotal:N,handleExtraArticleQuantityChange:P,handleQuantityChange:q}),e.jsx(b.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},className:"py-5",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[e.jsx(B,{paniers:x,selectedPaniers:c,handlePanierSelection:E}),e.jsx(U,{articles:p,selectedExtraArticles:d,handleExtraArticleSelection:Q}),e.jsx(b.div,{initial:{opacity:0,x:100},animate:{opacity:1,x:0},transition:{duration:.5,delay:1},className:"overflow-hidden bg-white shadow-sm sm:rounded-lg dark:bg-gray-800",children:e.jsx("div",{className:"p-6 text-gray-900 dark:text-gray-100",children:e.jsxs("form",{onSubmit:_,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-400",children:"Date Prévu"}),e.jsx("input",{type:"date",value:y.date,onChange:t=>o("date",t.target.value),min:new Date().toISOString().split("T")[0],className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300"}),e.jsx("span",{className:"text-red-500 text-xs",children:j.date})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-400",children:"Description (optionnel)"}),e.jsx("textarea",{value:y.description,onChange:t=>o("description",t.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300"}),e.jsx("span",{className:"text-red-500 text-xs",children:j.description})]}),e.jsx(b.button,{whileHover:{scale:1.05},whileTap:{scale:.95},type:"submit",disabled:C,className:"inline-flex items-center rounded-md border border-transparent bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:bg-indigo-500 dark:hover:bg-indigo-400",children:"Ajouter"})]})})})]})})]})};export{rt as default};
