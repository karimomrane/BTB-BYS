import{r as x,a as _,j as e,M as q,R as C}from"./app-uSIkskE8.js";import{A as R}from"./AuthenticatedLayout-CazaZbpy.js";import{D as U,k as M}from"./index-hxiEgb5P.js";import O from"./ExtraArticlesSection-C2d3t-9F.js";import F from"./PanierSelectionSection-DXMhhZb6.js";import{m as h}from"./proxy-zXC2lx42.js";import"./pdfmake-BosuxZz1.js";import"./transition-CoS_iRKR.js";import"./index-D3WjSJVV.js";import"./index-CAtoUjb3.js";const Y=({paniers:g,articles:p})=>{const[c,N]=x.useState([]),[o,y]=x.useState({});x.useState(!1),x.useState(!1);const[l,w]=x.useState([]),[m,u]=x.useState({}),{data:j,setData:n,post:v,errors:k,processing:D}=_({date:"",description:"",paniers:[],articles_commandes:[]}),S=t=>{N(a=>{let s;if(a.includes(t)){s=a.filter(d=>d!==t);const r={...o};delete r[t],y(r)}else s=[...a,t],y(r=>({...r,[t]:1}));const i=s.map(r=>({panier_id:r,quantity:o[r]||1}));return n("paniers",i),s})},A=(t,a)=>{y(s=>{const i={...s,[t]:a},r=c.map(d=>({panier_id:d,quantity:i[d]||1}));return n("paniers",r),i})},T=t=>{w(a=>{let s;if(a.includes(t)){s=a.filter(d=>d!==t);const r={...m};delete r[t],u(r)}else s=[...a,t],u(r=>({...r,[t]:1}));const i=s.map(r=>({article_id:r,quantity:m[r]||1}));return n("articles_commandes",i),s})},Q=(t,a)=>{u(s=>{const i={...s,[t]:a},r=l.map(d=>({article_id:d,quantity:i[d]||1}));return n("articles_commandes",r),i})},b=t=>{const a=o[t.id]||1;return t.price*a},f=t=>{const a=m[t.id]||1;return t.price*a},P=()=>{const t=c.reduce((s,i)=>{const r=g.find(d=>d.id===i);return s+b(r)},0),a=l.reduce((s,i)=>{const r=p.find(d=>d.id===i);return s+f(r)},0);return t+a},E=t=>{t.preventDefault();const a=c.map(i=>({panier_id:i,quantity:o[i]||1})),s=l.map(i=>({article_id:i,quantity:m[i]||1}));n("paniers",a),n("articles_commandes",s),v(route("commandes.store"),{onSuccess:()=>{},onError:()=>{M.error("Une erreur s'est produite lors de la création de la commande.")}})};return e.jsxs(R,{header:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800 dark:text-gray-200",children:"Ajouter une commande"}),children:[e.jsx(q,{title:"Ajouter une commande"}),e.jsx(U,{position:"bottom-center",reverseOrder:!1}),e.jsx(h.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},className:"py-5",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[e.jsx(F,{paniers:g,selectedPaniers:c,handlePanierSelection:S}),e.jsx(O,{articles:p,selectedExtraArticles:l,handleExtraArticleSelection:T}),e.jsx(h.div,{initial:{opacity:0,x:100},animate:{opacity:1,x:0},transition:{duration:.5,delay:1},className:"overflow-hidden bg-white shadow-sm sm:rounded-lg dark:bg-gray-800",children:e.jsx("div",{className:"p-6 text-gray-900 dark:text-gray-100",children:e.jsxs("form",{onSubmit:E,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-400",children:"Date Prévu"}),e.jsx("input",{type:"date",value:j.date,onChange:t=>n("date",t.target.value),min:new Date().toISOString().split("T")[0],className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300"}),e.jsx("span",{className:"text-red-500 text-xs",children:k.date})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-400",children:"Description (optionnel)"}),e.jsx("textarea",{value:j.description,onChange:t=>n("description",t.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300"}),e.jsx("span",{className:"text-red-500 text-xs",children:k.description})]}),c.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-400",children:"Détails des Paniers"}),e.jsx("div",{className:"mt-2",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400",children:"Produit"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400",children:"Prix Unitaire"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400",children:"Quantité"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400",children:"Total"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200 dark:bg-gray-800 dark:divide-gray-700",children:g.filter(t=>c.includes(t.id)).map(t=>e.jsxs(C.Fragment,{children:[e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:t.name}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:[t.price," DT"]}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:e.jsx("input",{type:"number",value:o[t.id]||1,onChange:a=>A(t.id,parseInt(a.target.value)),min:"1",className:"w-20 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300"})}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:[b(t)," DT"]})]}),t.articles&&t.articles.length>0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-4 py-2",children:e.jsx("div",{className:"pl-8",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400",children:"Article"}),e.jsx("th",{className:"text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400",children:"Quantité"})]})}),e.jsx("tbody",{children:t.articles.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"px-4 py-2 text-sm text-gray-900 dark:text-gray-100",children:a.name}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-900 dark:text-gray-100",children:a.pivot.quantity})]},a.id))})]})})})})]},t.id))})]})})]}),l.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-400",children:"Détails des Articles Supplémentaires"}),e.jsx("div",{className:"mt-2",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400",children:"Article"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400",children:"Prix Unitaire"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400",children:"Quantité"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400",children:"Total"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200 dark:bg-gray-800 dark:divide-gray-700",children:p.filter(t=>l.includes(t.id)).map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:t.name}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:[t.price," DT"]}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:e.jsx("input",{type:"number",value:m[t.id]||1,onChange:a=>Q(t.id,parseInt(a.target.value)),min:"1",className:"w-20 rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300"})}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:[f(t)," DT"]})]},t.id))})]})})]}),e.jsx("div",{className:"mt-4 text-right",children:e.jsxs("p",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:["Total: ",P()," DT"]})}),e.jsx(h.button,{whileHover:{scale:1.05},whileTap:{scale:.95},type:"submit",disabled:D,className:"inline-flex items-center rounded-md border border-transparent bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:bg-indigo-500 dark:hover:bg-indigo-400",children:"Ajouter"})]})})})]})})]})};export{Y as default};
