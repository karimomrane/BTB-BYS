import{r as u,a as L,j as t,M as R}from"./app-C3nkW_XF.js";import{A as U}from"./AuthenticatedLayout-ScSi__ya.js";import{D as J,k as K}from"./index-sznDZ362.js";import{b as V}from"./index-ft7PuHZe.js";import W from"./ExtraArticlesSection-Dh3cbZMe.js";import X from"./PanierSelectionSection-Dzlb5xpn.js";import Y from"./Cart-CmLXLGZo.js";import{F as Z}from"./index-CP-B8qCt.js";import{A as $}from"./index-CGSetZjF.js";import{m as h}from"./proxy-BUTcjXEC.js";import"./pdfmake-BosuxZz1.js";import"./transition-DSC19wzS.js";import"./iconBase-0uPeMGQ6.js";/* empty css               */const xe=({paniers:g,articles:f})=>{const[d,C]=u.useState([]),[x,y]=u.useState({}),[l,E]=u.useState([]),[p,b]=u.useState({}),[Q,j]=u.useState(!1),[m,v]=u.useState(null),{data:S,setData:c,post:_,errors:k,processing:q}=L({date:"",description:"",paniers:[],articles_commandes:[]}),P=e=>{const s=g.find(a=>a.id===e),r=d.includes(e);v({id:e,type:"panier",name:s.name,direction:r?"reverse":"forward"}),C(a=>{let i;if(r){i=a.filter(w=>w!==e);const n={...x};delete n[e],y(n)}else i=[...a,e],y(n=>({...n,[e]:1}));const o=i.map(n=>({panier_id:n,quantity:x[n]||1}));return c("paniers",o),i})},T=e=>{const s=f.find(a=>a.id===e),r=l.includes(e);v({id:e,type:"article",name:s.name,direction:r?"reverse":"forward"}),E(a=>{let i;if(r){i=a.filter(w=>w!==e);const n={...p};delete n[e],b(n)}else i=[...a,e],b(n=>({...n,[e]:1}));const o=i.map(n=>({article_id:n,quantity:p[n]||1}));return c("articles_commandes",o),i})},O=e=>{e.preventDefault();const s=d.map(a=>({panier_id:a,quantity:x[a]||1})),r=l.map(a=>({article_id:a,quantity:p[a]||1}));c("paniers",s),c("articles_commandes",r),_(route("commandes.store"),{onSuccess:()=>{},onError:()=>{K.error("Une erreur s'est produite lors de la création de la commande.")}})},z=()=>{v(null)},A=e=>{const s=x[e.id]||1;return e.price*s},N=e=>{const s=p[e.id]||1;return e.price*s},F=()=>{const e=d.reduce((r,a)=>{const i=g.find(o=>o.id===a);return r+A(i)},0),s=l.reduce((r,a)=>{const i=f.find(o=>o.id===a);return r+N(i)},0);return e+s},B=(e,s)=>{b(r=>{const a={...r,[e]:s},i=l.map(o=>({article_id:o,quantity:a[o]||1}));return c("articles_commandes",i),a})},M=(e,s)=>{y(r=>{const a={...r,[e]:s},i=d.map(o=>({panier_id:o,quantity:a[o]||1}));return c("paniers",i),a})},D=d.length+l.length,G=()=>{j(!0)},H=()=>{j(!1)};return t.jsxs(U,{header:t.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800 dark:text-gray-200",children:"Ajouter une commande"}),children:[t.jsx(R,{title:"Ajouter une commande"}),t.jsx(J,{position:"bottom-center",reverseOrder:!1}),t.jsx("div",{className:"fixed top-20 right-4 z-50",children:t.jsxs("button",{onClick:G,className:"relative p-3 bg-indigo-600 rounded-full text-white hover:bg-indigo-500 focus:outline-none",children:[t.jsx(V,{className:"w-6 h-6"}),D>0&&t.jsx("span",{className:"absolute top-0 right-0 bg-red-500 text-white text-xs rounded-full px-2 py-1",children:D})]})}),t.jsx(Y,{paniers:g,articles:f,selectedPaniers:d,panierQuantities:x,selectedExtraArticles:l,extraArticleQuantities:p,isCartOpen:Q,setIsCartOpen:j,closeCart:H,calculateGrandTotal:F,calculatePanierTotal:A,calculateExtraArticleTotal:N,handleExtraArticleQuantityChange:B,handleQuantityChange:M}),t.jsx($,{children:m&&t.jsx(h.div,{initial:{opacity:1,scale:1,position:"fixed",top:m.direction==="forward"?"50%":"5rem",left:m.direction==="forward"?"50%":"calc(100% - 4rem)",zIndex:1e3},animate:{opacity:0,scale:.5,top:m.direction==="forward"?"5rem":"50%",left:m.direction==="forward"?"calc(100% - 4rem)":"50%",zIndex:1e3},exit:{opacity:0,scale:0},transition:{duration:1,ease:"easeInOut"},onAnimationComplete:z,className:"z-50",style:{zIndex:1e3},children:t.jsx("div",{className:" text-green-500 px-3 py-1 rounded-full text-5xl",children:t.jsx(Z,{})})},m.id)}),t.jsx(h.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},className:"py-5",children:t.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[t.jsx(X,{paniers:g,selectedPaniers:d,handlePanierSelection:P}),t.jsx(W,{articles:f,selectedExtraArticles:l,handleExtraArticleSelection:T}),t.jsx(h.div,{initial:{opacity:0,x:100},animate:{opacity:1,x:0},transition:{duration:.5,delay:1},className:"overflow-hidden bg-white shadow-sm sm:rounded-lg dark:bg-gray-800",children:t.jsx("div",{className:"p-6 text-gray-900 dark:text-gray-100",children:t.jsxs("form",{onSubmit:O,children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-400",children:"Date de livraison prévu"}),t.jsx("input",{type:"date",value:S.date,onChange:e=>c("date",e.target.value),onBlur:e=>{const s=new Date(e.target.value),r=new Date;s<r&&c("date",r.toISOString().split("T")[0])},min:new Date().toISOString().split("T")[0],className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300"}),t.jsx("span",{className:"text-red-500 text-xs",children:k.date})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-400",children:"Commentaire"}),t.jsx("textarea",{value:S.description,onChange:e=>c("description",e.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300"}),t.jsx("span",{className:"text-red-500 text-xs",children:k.description})]}),t.jsx(h.button,{whileHover:{scale:1.05},whileTap:{scale:.95},type:"submit",disabled:q,className:"inline-flex items-center rounded-md border border-transparent bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:bg-indigo-500 dark:hover:bg-indigo-400",children:"Ajouter"})]})})})]})})]})};export{xe as default};
