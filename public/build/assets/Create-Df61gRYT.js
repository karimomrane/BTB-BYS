import{a as w,r as A,j as e,M as C,U as E}from"./app-sWLnvHQw.js";import{A as _}from"./AuthenticatedLayout-BuiuXDqw.js";import{D,c as l}from"./index-BB1XG3Nh.js";import{I as p}from"./InputError-CWDIa27h.js";import"./pdfmake-BosuxZz1.js";import"./transition-D9y0WISi.js";import"./proxy-B-3nq9fy.js";import"./index-BrPijOOA.js";import"./iconBase-DZn_rWyh.js";const F=({articles:h,paniers:m})=>{const{data:i,setData:o,post:y,processing:g,errors:u,reset:b}=w({panier_id:"",articles:[]}),[x,f]=A.useState(""),j=h.filter(r=>r.name.toLowerCase().includes(x.toLowerCase())),n=m.find(r=>String(r.id)===i.panier_id),c=n!=null&&n.articles?n.articles.map(r=>r.id):[];console.log(c);const k=(r,a)=>{if(a){if(c.includes(r)){l.error("Cet article est déjà associé à ce panier.");return}o("articles",[...i.articles,{id:r,ready:!1,extra:!1,quantity:1}])}else o("articles",i.articles.filter(s=>s.id!==r))},v=(r,a)=>{const s=i.articles.map(t=>t.id===r?{...t,quantity:parseInt(a,10)}:t);o("articles",s)},N=r=>{r.preventDefault();const a=new FormData;a.append("panier_id",i.panier_id),i.articles.forEach((s,t)=>{a.append(`articles[${t}][id]`,s.id),a.append(`articles[${t}][ready]`,s.ready),a.append(`articles[${t}][extra]`,s.extra),a.append(`articles[${t}][quantity]`,s.quantity)}),y(route("article_paniers.store"),a,{onSuccess:()=>{l.success("Articles ajoutés au panier avec succès!"),b()},onError:s=>{console.error("Validation Errors:",s),l.error("Une erreur s'est produite lors de la validation.")}})};return e.jsxs(_,{header:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800 dark:text-gray-200",children:"Ajouter des articles au panier"}),children:[e.jsx(C,{title:"Ajouter des articles au panier"}),e.jsx(D,{}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:e.jsx("div",{className:"overflow-hidden bg-white shadow-sm sm:rounded-lg dark:bg-gray-800",children:e.jsx("div",{className:"p-6 text-gray-900 dark:text-gray-100",children:e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Panier"}),e.jsxs("select",{value:i.panier_id,onChange:r=>{o("panier_id",r.target.value),o("articles",[])},className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",children:[e.jsx("option",{value:"",children:"Sélectionner un panier"}),m.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]}),e.jsx(p,{message:u.panier_id,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Rechercher des articles"}),e.jsx("input",{type:"text",placeholder:"Rechercher un article...",value:x,onChange:r=>f(r.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100"})]}),e.jsxs("div",{className:"h-[400px] overflow-y-auto",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Articles"}),e.jsx("div",{className:"mt-1 space-y-2",children:j.map(r=>{var t;const a=i.articles.some(d=>d.id===r.id),s=c.includes(r.id);return e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded-lg dark:border-gray-600",children:[e.jsxs("label",{className:`flex items-center space-x-4 cursor-pointer ${s&&"opacity-50 cursor-not-allowed"}`,children:[e.jsx("input",{type:"checkbox",checked:a,disabled:s,onChange:d=>k(r.id,d.target.checked),className:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:bg-gray-700 dark:border-gray-600"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:r.name})]}),a&&e.jsx("input",{type:"number",min:"1",value:((t=i.articles.find(d=>d.id===r.id))==null?void 0:t.quantity)||1,onChange:d=>v(r.id,d.target.value),className:"w-16 rounded border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 text-right"})]},r.id)})}),e.jsx(p,{message:u.articles,className:"mt-2"})]}),e.jsxs("div",{className:"flex justify-end",children:[e.jsx(E,{href:route("paniers.index"),className:"px-4 py-2 mr-2 text-sm font-medium text-gray-700 bg-gray-100 rounded hover:bg-gray-200 dark:text-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600",children:"Annuler"}),e.jsx("button",{type:"submit",disabled:g,className:"px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded hover:bg-indigo-700 dark:bg-indigo-500 dark:hover:bg-indigo-600",children:g?"Enregistrement...":"Enregistrer"})]})]})})})})})]})};export{F as default};
