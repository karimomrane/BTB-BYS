import{r as g,a as P,j as e,M as S,R as T}from"./app-CfxwoAt8.js";import{A}from"./AuthenticatedLayout-GCU5Ylj5.js";import{D as C,k as Q}from"./index-CiZk0RZ0.js";import{m as i}from"./proxy-Cyvb93Al.js";import{A as q}from"./index-DfiY5tnm.js";import"./pdfmake-CI9llB55.js";import"./transition-o3MW2CAL.js";import"./index-B1fRAH6A.js";const H=({paniers:x})=>{const[d,b]=g.useState([]),[c,m]=g.useState({}),[u,j]=g.useState(!1),{data:h,setData:l,post:f,errors:y,processing:k}=P({date:"",description:"",paniers:[]}),N=t=>{b(a=>{let s;if(a.includes(t)){s=a.filter(o=>o!==t);const r={...c};delete r[t],m(r)}else s=[...a,t],m(r=>({...r,[t]:1}));const n=s.map(r=>({panier_id:r,quantity:c[r]||1}));return l("paniers",n),s})},v=(t,a)=>{m(s=>{const n={...s,[t]:a},r=d.map(o=>({panier_id:o,quantity:n[o]||1}));return l("paniers",r),n})},p=t=>{const a=c[t.id]||1;return t.price*a},w=()=>d.reduce((t,a)=>{const s=x.find(n=>n.id===a);return t+p(s)},0),D=t=>{t.preventDefault();const a=d.map(s=>({panier_id:s,quantity:c[s]||1}));l("paniers",a),f(route("commandes.store"),{onSuccess:()=>{},onError:()=>{Q.error("Une erreur s'est produite lors de la création de la commande.")}})};return e.jsxs(A,{header:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800 dark:text-gray-200",children:"Ajouter une commande"}),children:[e.jsx(S,{title:"Ajouter une commande"}),e.jsx(C,{position:"bottom-center",reverseOrder:!1}),e.jsx(i.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},className:"py-5",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[e.jsx(i.div,{initial:{y:-50,opacity:0},animate:{y:0,opacity:1},transition:{duration:.5},className:"relative overflow-hidden bg-cover bg-center h-64 rounded-lg mb-8",style:{backgroundImage:"url(/cmdd.jpg)"},children:e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center p-6",children:e.jsxs("div",{className:"w-full max-w-2xl",children:[e.jsxs("button",{onClick:()=>j(t=>!t),className:"w-full text-left bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg flex items-center justify-between",children:[e.jsx("span",{children:"Sélectionner des Paniers"}),e.jsx(i.span,{initial:{rotate:0},animate:{rotate:u?180:0},transition:{duration:.3},className:"ml-2 transform",children:"▼"})]}),e.jsx(q,{children:u&&e.jsx(i.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},className:"mt-4 space-y-4",children:x.map(t=>e.jsxs(i.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{duration:.3},className:"flex items-center justify-between p-3 bg-white rounded-lg shadow-sm hover:bg-indigo-50 dark:bg-gray-800 dark:hover:bg-gray-700",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("input",{type:"checkbox",checked:d.includes(t.id),onChange:()=>N(t.id),className:"form-checkbox h-5 w-5 text-indigo-600 rounded focus:ring-indigo-500 dark:focus:ring-indigo-400"}),e.jsx("span",{className:"font-medium text-indigo-600 dark:text-indigo-400",children:t.name})]}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:[t.price," DT"]})]},t.id))})})]})})}),e.jsx(i.div,{initial:{opacity:0,x:100},animate:{opacity:1,x:0},transition:{duration:.5,delay:1},className:"overflow-hidden bg-white shadow-sm sm:rounded-lg dark:bg-gray-800",children:e.jsx("div",{className:"p-6 text-gray-900 dark:text-gray-100",children:e.jsxs("form",{onSubmit:D,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-400",children:"Date Prévu"}),e.jsx("input",{type:"date",value:h.date,onChange:t=>l("date",t.target.value),min:new Date().toISOString().split("T")[0],className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300"}),e.jsx("span",{className:"text-red-500 text-xs",children:y.date})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-400",children:"Description (optionnel)"}),e.jsx("textarea",{value:h.description,onChange:t=>l("description",t.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300"}),e.jsx("span",{className:"text-red-500 text-xs",children:y.description})]}),d.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-400",children:"Détails de la Commande"}),e.jsx("div",{className:"mt-2",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400",children:"Produit"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400",children:"Prix Unitaire"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400",children:"Quantité"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400",children:"Total"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200 dark:bg-gray-800 dark:divide-gray-700",children:x.filter(t=>d.includes(t.id)).map(t=>e.jsxs(T.Fragment,{children:[e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:t.name}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:[t.price," DT"]}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:e.jsx("input",{type:"number",value:c[t.id]||1,onChange:a=>v(t.id,parseInt(a.target.value)),min:"1",className:"w-20 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300"})}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:[p(t)," DT"]})]}),t.articles&&t.articles.length>0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-4 py-2",children:e.jsx("div",{className:"pl-8",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400",children:"Article"}),e.jsx("th",{className:"text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400",children:"Quantité"})]})}),e.jsx("tbody",{children:t.articles.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"px-4 py-2 text-sm text-gray-900 dark:text-gray-100",children:a.name}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-900 dark:text-gray-100",children:a.pivot.quantity})]},a.id))})]})})})})]},t.id))})]})}),e.jsx("div",{className:"mt-4 text-right",children:e.jsxs("p",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:["Total: ",w()," DT"]})})]}),e.jsx(i.button,{whileHover:{scale:1.05},whileTap:{scale:.95},type:"submit",disabled:k,className:"inline-flex items-center rounded-md border border-transparent bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:bg-indigo-500 dark:hover:bg-indigo-400",children:"Ajouter"})]})})})]})})]})};export{H as default};
